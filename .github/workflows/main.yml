name: Manual workflow

# Controls when the action will run. Workflow runs when manually triggered using the UI or API.
on:
  workflow_dispatch:
    inputs:
      test-folder:
        description: 'The full absolute path of UFT tests folder'
        default: 'D:\Work\UFTTests\Success'
        required: true
env:
  PROPS_TXT: PropsMultiTests.txt
  LAUNCHER_EXE: FTToolsLauncher.exe
  LAUNCHER_URL: https://github.com/MicroFocus/ADM-FT-ToolsLauncher/releases/download/v1.0-beta-rev12/FTToolsLauncher_net48.exe
defaults:
  run:
    shell: pwsh
    #working-directory: ${{GITHUB_WORKSPACE}}

jobs:
  getUftOneTests:
    runs-on: self-hosted
    steps:
    - name: Display the working folder
      run: echo "$env:GITHUB_WORKSPACE"
    - name: Checkout current repo
      uses: actions/checkout@v3
      with:
        ref: main

  createPropsFile:
    runs-on: self-hosted
    steps:
    - run: |
        "runType=FileSystem" > $env:PROPS_TXT
        "Test1=$($pwd.Path.Replace("\", "\\"))" >> $env:PROPS_TXT
        "resultsFilename=ResultsMultiTests.xml" >> $env:PROPS_TXT

  runUftTestFromFileSystem:
    runs-on: self-hosted
    steps:
    - name: Get FTToolsLauncher.exe
      run: curl -L -o $env:LAUNCHER_EXE $env:LAUNCHER_URL
    - name: Run FT tool
      run: $p = Start-Process -FilePath "$env:LAUNCHER_EXE" -ArgumentList "-paramfile $env:PROPS_TXT" -Wait -PassThru -NoNewWindow
    - name: Get Exit Code
      run: $x = $p.ExitCode
    - name: Final Status
      run: if ($x -eq 0) { Write-Host 'PASS' } else {Write-Error 'FAIL' }
      
